var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.NavigationStateContext=void 0;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var React=_interopRequireWildcard(require("react"));var CommonActions=_interopRequireWildcard(require("./CommonActions"));var _EnsureSingleNavigator=_interopRequireDefault(require("./EnsureSingleNavigator"));var _NavigationBuilderContext=_interopRequireDefault(require("./NavigationBuilderContext"));var _ResetRootContext=_interopRequireDefault(require("./ResetRootContext"));var _useFocusedListeners2=_interopRequireDefault(require("./useFocusedListeners"));var _useDevTools2=_interopRequireDefault(require("./useDevTools"));var _useStateGetters2=_interopRequireDefault(require("./useStateGetters"));var _jsxFileName="/Users/osdnk/work/navigation-ex/packages/core/src/NavigationContainer.tsx";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}var MISSING_CONTEXT_ERROR="We couldn't find a navigation context. Have you wrapped your app with 'NavigationContainer'?";var NavigationStateContext=React.createContext({isDefault:true,get getState(){throw new Error(MISSING_CONTEXT_ERROR);},get setState(){throw new Error(MISSING_CONTEXT_ERROR);},get performTransaction(){throw new Error(MISSING_CONTEXT_ERROR);}});exports.NavigationStateContext=NavigationStateContext;var getPartialState=function getPartialState(state){if(state===undefined){return;}var key=state.key,routeNames=state.routeNames,partialState=(0,_objectWithoutProperties2.default)(state,["key","routeNames"]);return _objectSpread({},partialState,{stale:true,routes:state.routes.map(function(route){if(route.state===undefined){return route;}return _objectSpread({},route,{state:getPartialState(route.state)});})});};var Container=React.forwardRef(function NavigationContainer(_ref,ref){var initialState=_ref.initialState,onStateChange=_ref.onStateChange,independent=_ref.independent,children=_ref.children;var parent=React.useContext(NavigationStateContext);if(!parent.isDefault&&!independent){throw new Error("Looks like you have nested a 'NavigationContainer' inside another. Normally you need only one container at the root of the app, so this was probably an error. If this was intentional, pass 'independent={true}' explicitely.");}var _React$useState=React.useState(function(){return getPartialState(initialState==null?undefined:initialState);}),_React$useState2=(0,_slicedToArray2.default)(_React$useState,2),state=_React$useState2[0],setNavigationState=_React$useState2[1];var navigationStateRef=React.useRef();var transactionStateRef=React.useRef(null);var isTransactionActiveRef=React.useRef(false);var isFirstMountRef=React.useRef(true);var skipTrackingRef=React.useRef(false);var performTransaction=React.useCallback(function(callback){if(isTransactionActiveRef.current){throw new Error("Only one transaction can be active at a time. Did you accidentally nest 'performTransaction'?");}setNavigationState(function(navigationState){isTransactionActiveRef.current=true;transactionStateRef.current=navigationState;try{callback();}finally{isTransactionActiveRef.current=false;}return transactionStateRef.current;});},[]);var getState=React.useCallback(function(){return transactionStateRef.current!==null?transactionStateRef.current:navigationStateRef.current;},[]);var setState=React.useCallback(function(navigationState){if(transactionStateRef.current===null){throw new Error("Any 'setState' calls need to be done inside 'performTransaction'");}transactionStateRef.current=navigationState;},[]);var reset=React.useCallback(function(state){performTransaction(function(){skipTrackingRef.current=true;setState(state);});},[performTransaction,setState]);var _useDevTools=(0,_useDevTools2.default)({name:'@react-navigation',reset:reset,state:state}),trackState=_useDevTools.trackState,trackAction=_useDevTools.trackAction;var _useFocusedListeners=(0,_useFocusedListeners2.default)(),listeners=_useFocusedListeners.listeners,addFocusedListener=_useFocusedListeners.addListener;var _useStateGetters=(0,_useStateGetters2.default)(),getStateForRoute=_useStateGetters.getStateForRoute,addStateGetter=_useStateGetters.addStateGetter;var dispatch=function dispatch(action){listeners[0](function(navigation){return navigation.dispatch(action);});};var canGoBack=function canGoBack(){var _listeners$=listeners[0](function(navigation){return navigation.canGoBack();}),result=_listeners$.result,handled=_listeners$.handled;if(handled){return result;}else{return false;}};var resetRoot=React.useCallback(function(state){performTransaction(function(){trackAction('@@RESET_ROOT');setState(state);});},[performTransaction,setState,trackAction]);var getRootState=React.useCallback(function(){return getStateForRoute('root');},[getStateForRoute]);React.useImperativeHandle(ref,function(){return _objectSpread({},Object.keys(CommonActions).reduce(function(acc,name){acc[name]=function(){return dispatch(CommonActions[name].apply(CommonActions,arguments));};return acc;},{}),{resetRoot:resetRoot,dispatch:dispatch,canGoBack:canGoBack,getRootState:getRootState});});var builderContext=React.useMemo(function(){return{addFocusedListener:addFocusedListener,addStateGetter:addStateGetter,trackAction:trackAction};},[addFocusedListener,trackAction,addStateGetter]);var context=React.useMemo(function(){return{state:state,performTransaction:performTransaction,getState:getState,setState:setState};},[getState,performTransaction,setState,state]);React.useEffect(function(){if(skipTrackingRef.current){skipTrackingRef.current=false;}else{trackState(getRootState);}navigationStateRef.current=state;transactionStateRef.current=null;if(!isFirstMountRef.current&&onStateChange){onStateChange(getRootState());}isFirstMountRef.current=false;},[state,onStateChange,trackState,getRootState]);return React.createElement(_NavigationBuilderContext.default.Provider,{value:builderContext,__source:{fileName:_jsxFileName,lineNumber:262}},React.createElement(NavigationStateContext.Provider,{value:context,__source:{fileName:_jsxFileName,lineNumber:263}},React.createElement(_ResetRootContext.default.Provider,{value:resetRoot,__source:{fileName:_jsxFileName,lineNumber:264}},React.createElement(_EnsureSingleNavigator.default,{__source:{fileName:_jsxFileName,lineNumber:265}},children))));});var _default=Container;exports.default=_default;
//# sourceMappingURL=NavigationContainer.js.map