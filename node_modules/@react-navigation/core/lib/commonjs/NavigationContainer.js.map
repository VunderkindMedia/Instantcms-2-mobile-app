{"version":3,"sources":["NavigationContainer.tsx"],"names":["MISSING_CONTEXT_ERROR","NavigationStateContext","React","createContext","isDefault","getState","Error","setState","performTransaction","getPartialState","state","undefined","key","routeNames","partialState","stale","routes","map","route","Container","forwardRef","NavigationContainer","ref","initialState","onStateChange","independent","children","parent","useContext","useState","setNavigationState","navigationStateRef","useRef","transactionStateRef","isTransactionActiveRef","isFirstMountRef","skipTrackingRef","useCallback","callback","current","navigationState","reset","name","trackState","trackAction","listeners","addFocusedListener","addListener","getStateForRoute","addStateGetter","dispatch","action","navigation","canGoBack","result","handled","resetRoot","getRootState","useImperativeHandle","Object","keys","CommonActions","reduce","acc","builderContext","useMemo","context","useEffect"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as CommonActions from './CommonActions';\nimport EnsureSingleNavigator from './EnsureSingleNavigator';\nimport NavigationBuilderContext from './NavigationBuilderContext';\nimport ResetRootContext from './ResetRootContext';\nimport useFocusedListeners from './useFocusedListeners';\nimport useDevTools from './useDevTools';\nimport useStateGetters from './useStateGetters';\n\nimport {\n  Route,\n  NavigationState,\n  InitialState,\n  PartialState,\n  NavigationAction,\n  NavigationContainerRef,\n  NavigationContainerProps,\n} from './types';\n\ntype State = NavigationState | PartialState<NavigationState> | undefined;\n\nconst MISSING_CONTEXT_ERROR =\n  \"We couldn't find a navigation context. Have you wrapped your app with 'NavigationContainer'?\";\n\nexport const NavigationStateContext = React.createContext<{\n  isDefault?: true;\n  state?: NavigationState | PartialState<NavigationState>;\n  getState: () => NavigationState | PartialState<NavigationState> | undefined;\n  setState: (\n    state: NavigationState | PartialState<NavigationState> | undefined\n  ) => void;\n  key?: string;\n  performTransaction: (action: () => void) => void;\n}>({\n  isDefault: true,\n\n  get getState(): any {\n    throw new Error(MISSING_CONTEXT_ERROR);\n  },\n  get setState(): any {\n    throw new Error(MISSING_CONTEXT_ERROR);\n  },\n  get performTransaction(): any {\n    throw new Error(MISSING_CONTEXT_ERROR);\n  },\n});\n\n/**\n * Remove `key` and `routeNames` from the state objects recursively to get partial state.\n *\n * @param state Initial state object.\n */\nconst getPartialState = (\n  state: InitialState | undefined\n): PartialState<NavigationState> | undefined => {\n  if (state === undefined) {\n    return;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const { key, routeNames, ...partialState } = state;\n\n  // @ts-ignore\n  return {\n    ...partialState,\n    stale: true,\n    routes: state.routes.map(route => {\n      if (route.state === undefined) {\n        return route as Route<string> & {\n          state?: PartialState<NavigationState>;\n        };\n      }\n\n      return { ...route, state: getPartialState(route.state) };\n    }),\n  };\n};\n\n/**\n * Container component which holds the navigation state.\n * This should be rendered at the root wrapping the whole app.\n *\n * @param props.initialState Initial state object for the navigation tree.\n * @param props.onStateChange Callback which is called with the latest navigation state when it changes.\n * @param props.children Child elements to render the content.\n * @param props.ref Ref object which refers to the navigation object containing helper methods.\n */\nconst Container = React.forwardRef(function NavigationContainer(\n  {\n    initialState,\n    onStateChange,\n    independent,\n    children,\n  }: NavigationContainerProps,\n  ref: React.Ref<NavigationContainerRef>\n) {\n  const parent = React.useContext(NavigationStateContext);\n\n  if (!parent.isDefault && !independent) {\n    throw new Error(\n      \"Looks like you have nested a 'NavigationContainer' inside another. Normally you need only one container at the root of the app, so this was probably an error. If this was intentional, pass 'independent={true}' explicitely.\"\n    );\n  }\n\n  const [state, setNavigationState] = React.useState<State>(() =>\n    getPartialState(initialState == null ? undefined : initialState)\n  );\n\n  const navigationStateRef = React.useRef<State>();\n  const transactionStateRef = React.useRef<State | null>(null);\n  const isTransactionActiveRef = React.useRef<boolean>(false);\n  const isFirstMountRef = React.useRef<boolean>(true);\n  const skipTrackingRef = React.useRef<boolean>(false);\n\n  const performTransaction = React.useCallback((callback: () => void) => {\n    if (isTransactionActiveRef.current) {\n      throw new Error(\n        \"Only one transaction can be active at a time. Did you accidentally nest 'performTransaction'?\"\n      );\n    }\n\n    setNavigationState((navigationState: State) => {\n      isTransactionActiveRef.current = true;\n      transactionStateRef.current = navigationState;\n\n      try {\n        callback();\n      } finally {\n        isTransactionActiveRef.current = false;\n      }\n\n      return transactionStateRef.current;\n    });\n  }, []);\n\n  const getState = React.useCallback(\n    () =>\n      transactionStateRef.current !== null\n        ? transactionStateRef.current\n        : navigationStateRef.current,\n    []\n  );\n\n  const setState = React.useCallback((navigationState: State) => {\n    if (transactionStateRef.current === null) {\n      throw new Error(\n        \"Any 'setState' calls need to be done inside 'performTransaction'\"\n      );\n    }\n\n    transactionStateRef.current = navigationState;\n  }, []);\n\n  const reset = React.useCallback(\n    (state: NavigationState) => {\n      performTransaction(() => {\n        skipTrackingRef.current = true;\n        setState(state);\n      });\n    },\n    [performTransaction, setState]\n  );\n\n  const { trackState, trackAction } = useDevTools({\n    name: '@react-navigation',\n    reset,\n    state,\n  });\n\n  const { listeners, addListener: addFocusedListener } = useFocusedListeners();\n\n  const { getStateForRoute, addStateGetter } = useStateGetters();\n\n  const dispatch = (\n    action: NavigationAction | ((state: NavigationState) => NavigationAction)\n  ) => {\n    listeners[0](navigation => navigation.dispatch(action));\n  };\n\n  const canGoBack = () => {\n    const { result, handled } = listeners[0](navigation =>\n      navigation.canGoBack()\n    );\n\n    if (handled) {\n      return result;\n    } else {\n      return false;\n    }\n  };\n\n  const resetRoot = React.useCallback(\n    (state?: PartialState<NavigationState> | NavigationState) => {\n      performTransaction(() => {\n        trackAction('@@RESET_ROOT');\n        setState(state);\n      });\n    },\n    [performTransaction, setState, trackAction]\n  );\n\n  const getRootState = React.useCallback(() => {\n    return getStateForRoute('root');\n  }, [getStateForRoute]);\n\n  React.useImperativeHandle(ref, () => ({\n    ...(Object.keys(CommonActions) as (keyof typeof CommonActions)[]).reduce<\n      any\n    >((acc, name) => {\n      acc[name] = (...args: any[]) =>\n        dispatch(\n          CommonActions[name](\n            // @ts-ignore\n            ...args\n          )\n        );\n      return acc;\n    }, {}),\n    resetRoot,\n    dispatch,\n    canGoBack,\n    getRootState,\n  }));\n\n  const builderContext = React.useMemo(\n    () => ({\n      addFocusedListener,\n      addStateGetter,\n      trackAction,\n    }),\n    [addFocusedListener, trackAction, addStateGetter]\n  );\n\n  const context = React.useMemo(\n    () => ({\n      state,\n      performTransaction,\n      getState,\n      setState,\n    }),\n    [getState, performTransaction, setState, state]\n  );\n\n  React.useEffect(() => {\n    if (skipTrackingRef.current) {\n      skipTrackingRef.current = false;\n    } else {\n      trackState(getRootState);\n    }\n\n    navigationStateRef.current = state;\n    transactionStateRef.current = null;\n\n    if (!isFirstMountRef.current && onStateChange) {\n      onStateChange(getRootState());\n    }\n\n    isFirstMountRef.current = false;\n  }, [state, onStateChange, trackState, getRootState]);\n\n  return (\n    <NavigationBuilderContext.Provider value={builderContext}>\n      <NavigationStateContext.Provider value={context}>\n        <ResetRootContext.Provider value={resetRoot}>\n          <EnsureSingleNavigator>{children}</EnsureSingleNavigator>\n        </ResetRootContext.Provider>\n      </NavigationStateContext.Provider>\n    </NavigationBuilderContext.Provider>\n  );\n});\n\nexport default Container;\n"]}